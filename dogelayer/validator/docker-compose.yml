version: '3.8'

services:
  dogelayer-validator:
    image: coinflow/dogelayer-validator:latest
    container_name: dogelayer-validator
    restart: unless-stopped
    command: [
      "python", "-m", "taohash.validator.validator",
      "--netuid", "${NETUID}",
      "--subtensor.network", "${SUBTENSOR_NETWORK}",
      "--wallet.name", "${BT_WALLET_NAME}",
      "--wallet.hotkey", "${BT_WALLET_HOTKEY}",
      "--logging.level", "info"
    ]
    environment:
      # Bittensor 配置
      - NETUID=${NETUID:-14}
      - SUBTENSOR_NETWORK=${SUBTENSOR_NETWORK:-finney}
      - BT_WALLET_NAME=${BT_WALLET_NAME:-default}
      - BT_WALLET_HOTKEY=${BT_WALLET_HOTKEY:-default}

      # 子网代理配置（验证者获取数据用）
      - SUBNET_PROXY_API_URL=${SUBNET_PROXY_API_URL:-http://127.0.0.1:8888}
      - SUBNET_PROXY_API_TOKEN=${SUBNET_PROXY_API_TOKEN:-2z1gLMqF6yZuf9G56iCLi5H6lKPMWJ_kgiYp-61_gAI}

      # 恢复配置
      - RECOVERY_FILE_PATH=/app/data
      - RECOVERY_FILE_NAME=validator_state.json

      # 日志配置
      - LOGGING_LEVEL=info

    volumes:
      # 挂载钱包数据（需要读写权限）
      - ~/.bittensor:/root/.bittensor
      # 挂载恢复文件
      - ./data:/app/data
      # 挂载配置文件
      - ./config:/app/config

    network_mode: host

volumes:
  validator-data:
